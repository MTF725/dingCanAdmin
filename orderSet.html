<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>订餐设置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap-table/bootstrap-table.min.css">
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    <style type="text/css">
    .set-item{overflow:hidden;}
    .set-item .tit{padding:10px;background:#f9f9f9;}
    .set-item .set-main{width:400px;height:250px;border:1px solid #ddd;margin:20px auto;}
    .set-item .sendfee-set-main{height:210px;}
    .set-item .btn-wrap{text-align:center;position:relative;top:60px;}
    .form-layer .layui-form-label{width:120px;}
    .form-layer .layui-input-block{margin-left:120px;}
    .layui-btn-primary:hover{border-color:#ccc;}
    .cuiTime{position:relative;}
    .btn-wrap{display:none;}
    .set-main .btn-wrap{margin-left:130px;}
    .fixed-orderset{padding:10px;}
    .set-main .layui-btn-normal{padding: 0 40px;}
    </style>
</head>

<body>
    <div class="layui-fluid">
        <div class="layui-row">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-body" style="padding: 0;">
                        <div class="fixed-orderset layui-form isSuperAdmin">
                            <div class="layui-input-inline">
                                <label class="form-label">单位名称</label>
                                <select id="unitName" lay-filter="unitName">
                                    <option></option>
                                </select>
                            </div>
                            <div class="layui-input-inline">
                                <a class="layui-btn layui-btn-normal" onclick="searchBtn()">查询</a>
                            </div>
                        </div>
                        <div class="set-item">
                            <p class="tit">配送费设置</p>
                            <div class="set-main sendfee-set-main">
                                <p class="tit">配送费设置</p>
                                <div class="layui-fluid form-layer layui-form layui-form">
                                    <div class="layui-row">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>配送费:</label>
                                            <div class="layui-input-block">
                                                <input placeholder="元" type="text" autocomplete="off"
                                                    class="layui-input" id="sendFee">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-wrap isAdmin">
                                        <a class="layui-btn layui-btn-normal" onclick="sendFeeConfirmBtn()">确定</a>
                                        <!-- <a class="layui-btn layui-btn-primary" onclick="sendFeeCancelBtn()">关闭</a> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="set-item">
                            <p class="tit">催单时间设置</p>
                            <div class="set-main">
                                <p class="tit">催单时间设置</p>
                                <div class="layui-fluid form-layer layui-form layui-form">
                                    <div class="layui-row">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>下单后时间:</label>
                                            <div class="layui-input-block">
                                                <input placeholder="分钟" type="text" autocomplete="off"
                                                    class="layui-input" id="cuiTime">
                                            </div>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>是否启用:</label>
                                            <div class="layui-input-block">
                                                <select id="cuiStatus">
                                                    <option value="1">是</option>
                                                    <option value="0">否</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-wrap isAdmin">
                                        <a class="layui-btn layui-btn-normal" onclick="cuiConfirmBtn()">确定</a>
                                        <!-- <a class="layui-btn layui-btn-primary" onclick="cuiCancelBtn()">关闭</a> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="set-item">
                            <p class="tit">转单时间设置</p>
                            <div class="set-main">
                                <p class="tit">转单时间设置</p>
                                <div class="layui-fluid form-layer layui-form layui-form">
                                    <div class="layui-row">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>接单后时间:</label>
                                            <div class="layui-input-block">
                                                <input placeholder="分钟" type="text" autocomplete="off"
                                                    class="layui-input" id="zhuanTime">
                                            </div>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>是否启用:</label>
                                            <div class="layui-input-block">
                                                <select id="zhuanStatus">
                                                    <option value="1">是</option>
                                                    <option value="0">否</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-wrap isAdmin">
                                        <a class="layui-btn layui-btn-normal" onclick="zhuanConfirmBtn()">确定</a>
                                        <!-- <a class="layui-btn layui-btn-primary" onclick="zhuanCancelBtn()">关闭</a> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="set-item">
                            <p class="tit">评价超时设置</p>
                            <div class="set-main">
                                <p class="tit">评价超时设置</p>
                                <div class="layui-fluid form-layer layui-form layui-form">
                                    <div class="layui-row">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>评价超时时间:</label>
                                            <div class="layui-input-block">
                                                <input placeholder="天" type="text" autocomplete="off"
                                                    class="layui-input" id="pjTime">
                                            </div>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>是否启用:</label>
                                            <div class="layui-input-block">
                                                <select id="pjStatus">
                                                    <option value="1">是</option>
                                                    <option value="0">否</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-wrap isAdmin">
                                        <a class="layui-btn layui-btn-normal" onclick="pjConfirmBtn()">确定</a>
                                        <!-- <a class="layui-btn layui-btn-primary" onclick="pjCancelBtn()">关闭</a> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="set-item">
                            <p class="tit">商家取消订单时间设置</p>
                            <div class="set-main">
                                <p class="tit">商家取消订单时间设置</p>
                                <div class="layui-fluid form-layer layui-form layui-form">
                                    <div class="layui-row">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>取消订单时间设置:</label>
                                            <div class="layui-input-block">
                                                <input placeholder="分钟" type="text" autocomplete="off"
                                                    class="layui-input" id="cancelOrderTime">
                                            </div>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>是否启用:</label>
                                            <div class="layui-input-block">
                                                <select id="cancelOrderStatus">
                                                    <option value="1">是</option>
                                                    <option value="0">否</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-wrap isAdmin">
                                        <a class="layui-btn layui-btn-normal" onclick="cancelOrderConfirmBtn()">确定</a>
                                        <!-- <a class="layui-btn layui-btn-primary" onclick="cancelOrderCancelBtn()">关闭</a> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="set-item">
                            <p class="tit">付款时间设置</p>
                            <div class="set-main">
                                <p class="tit">付款时间设置</p>
                                <div class="layui-fluid form-layer layui-form layui-form">
                                    <div class="layui-row">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>付款时间设置:</label>
                                            <div class="layui-input-block">
                                                <input placeholder="分钟" type="text" autocomplete="off"
                                                    class="layui-input" id="payTime">
                                            </div>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label"><i class="star">*</i>是否启用:</label>
                                            <div class="layui-input-block">
                                                <select id="payStatus">
                                                    <option value="1">是</option>
                                                    <option value="0">否</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-wrap isAdmin">
                                        <a class="layui-btn layui-btn-normal" onclick="payConfirmBtn()">确定</a>
                                        <!-- <a class="layui-btn layui-btn-primary" onclick="payCancelBtn()">关闭</a> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="./lib/layui/layui.all.js" charset="utf-8"></script>
<script type="text/javascript" src="./js/xadmin.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="lib/bootstrap/bootstrap.min.js"></script>
<script type="text/javascript" src="lib/bootstrap-table/bootstrap-table.min.js"></script>
<script type="text/javascript" src="lib/bootstrap-table/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script>
     // 查询
    function searchBtn() {
        getTimeStatus();
    }
    $(function () {
        unitList('#unitName', 'id') //赋值单位名称下拉
        getTimeStatus();
    });

    //获取全部时间信息、状态
    function getTimeStatus() {
        $.ajax({
            url: port + '/v1/commonTime/get',
            xhrFields: {
                withCredentials: true
            },
            type: 'get',
            async: false,
            data: {
                cId: setUnitId('#unitName'), //单位id
            },
            success: function (e) {
                var data = e.data;
                console.log('时间详情', data);
               if(data!=null){
                    //配送费
                    $("#sendFee").val(data.deliveryFee)
                    //催单时间赋值
                    $('#cuiTime').val(data.reminderTime);
                    // 催单时间启用状态
                    $('#cuiStatus option').each(function (i, a) {
                        if (data.reminderTimeUseStatus == $(a).val()) {
                            $(a).attr('selected', true);
                            layui.form.render('select');
                        }else {
                            $(a).attr('selected', false);
                            layui.form.render('select');
                        }

                    });

                    //转单时间赋值
                    $('#zhuanTime').val(data.changeTime);
                    // 转单时间启用状态
                    $('#zhuanStatus option').each(function (i, a) {
                        if (data.changeTimeUseStatus == $(a).val()) {
                            $(a).attr('selected', true);
                            layui.form.render('select');
                        }else {
                            $(a).attr('selected', false);
                            layui.form.render('select');
                        }
                    });

                    //评价超时赋值
                    $('#pjTime').val(data.commentTime);
                    // 评价超时启用状态
                    $('#pjStatus option').each(function (i, a) {
                        if (data.commentTimeUseStatus == $(a).val()) {
                            $(a).attr('selected', true);
                            layui.form.render('select');
                        }else {
                            $(a).attr('selected', false);
                            layui.form.render('select');
                        }
                    });


                    //商家取消订单时间设置赋值
                    $('#cancelOrderTime').val(data.orderCancelTime);
                    // 商家取消订单时间设置启用状态
                    $('#cancelOrderStatus option').each(function (i, a) {
                        if (data.orderCancelTimeUseStatus == $(a).val()) {
                            $(a).attr('selected', true);
                            layui.form.render('select');
                        }else {
                            $(a).attr('selected', false);
                            layui.form.render('select');
                        }
                    });


                    //付款时间设置赋值
                    $('#payTime').val(data.payTime);
                    // 付款时间设置启用状态
                    $('#payStatus option').each(function (i, a) {
                        if (data.payTimeUseStatus == $(a).val()) {
                            $(a).attr('selected', true);
                            layui.form.render('select');
                        }else {
                            $(a).attr('selected', false);
                            layui.form.render('select');
                        }
                    });

                }
                layui.form.render('select');
            }
        });
    }

    ////////////////////////////////////////
    //配送费设置
    function sendFeeConfirmBtn() {
        if ($('#sendFee').val() == '') {
            layer.msg('请输入配送费');
            return;
        }

        // (^[1-9](\d+)?(\.\d{1,2})?$)|(^\d\.\d{1,2}$)
        if (!(/^\d+(\.\d+)?$/.test($('#sendFee').val()))) {
            layer.msg('价格必须是大于0的数字');
            return;
        }
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveDeliveryFee',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        deliveryFee: $('#sendFee').val(), //配送费用
                    },
                    success: function (e) {
                        console.log('配送费用', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定提交?</div>'
        });


    }

    // 催单时间设置确定
    function cuiConfirmBtn() {
        if ($('#cuiTime').val() == '') {
            layer.msg('请输入催单时间');
            return;
        }
        if (!zzsReg.test($('#cuiTime').val())) {
            layer.msg('催单时间必须是正整数');
            return;
        }
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveReminderTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        reminderTime: $('#cuiTime').val(), //催单时间
                        reminderTimeUseStatus: $('#cuiStatus').val() //是否启用
                    },
                    success: function (e) {
                        console.log('催单提交', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定提交?</div>'
        });


    }
    // 催单时间设置取消
    function cuiCancelBtn() {
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveReminderTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        reminderTime: $('#cuiTime').val(), //催单时间
                        reminderTimeUseStatus: 0 //是否启用
                    },
                    success: function (e) {
                        console.log('催单取消', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定关闭?</div>'
        });
    }


    ///////////////////////////////////////////////////////

    // 转单时间设置确定
    function zhuanConfirmBtn() {
        if ($('#zhuanTime').val() == '') {
            layer.msg('请输入转单时间');
            return;
        }
        if (!zzsReg.test($('#zhuanTime').val())) {
            layer.msg('转单时间必须是正整数');
            return;
        }
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveChangeTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        changeTime: $('#zhuanTime').val(), //转单时间
                        changeTimeUseStatus: $('#zhuanStatus').val() //是否启用
                    },
                    success: function (e) {
                        console.log('转单提交', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定提交?</div>'
        });


    }
    // 转单时间设置取消
    function zhuanCancelBtn() {
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveChangeTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        changeTime: $('#zhuanTime').val(), //转单时间
                        changeTimeUseStatus: 0 //是否启用
                    },
                    success: function (e) {
                        console.log('转单取消', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定关闭?</div>'
        });
    }

    //////////////////////////////////////////////////////////////////////////////////////

    // 评价超时时间设置确定
    function pjConfirmBtn() {
        if ($('#pjTime').val() == '') {
            layer.msg('请输入评价超时时间');
            return;
        }
        if (!zzsReg.test($('#pjTime').val())) {
            layer.msg('评价超时时间必须是正整数');
            return;
        }
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveCommentTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        commentTime: $('#pjTime').val(), //评价超时时间
                        commentTimeUseStatus: $('#pjStatus').val() //是否启用
                    },
                    success: function (e) {
                        console.log('评价超时时间提交', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定提交?</div>'
        });

    }

    // 评价超时时间设置取消
    function pjCancelBtn() {

        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveCommentTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        commentTime: $('#pjTime').val(), //评价超时时间
                        commentTimeUseStatus: 0 //是否启用
                    },
                    success: function (e) {
                        console.log('评价超时时间提交', e);
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定关闭?</div>'
        });
    }
    ///////////////////////////////////////////////////////////////////////////////

    // 商家取消订单时间设置确定
    function cancelOrderConfirmBtn() {
        if ($('#cancelOrderTime').val() == '') {
            layer.msg('请输入商家取消订单时间');
            return;
        }
        if (!zzsReg.test($('#cancelOrderTime').val())) {
            layer.msg('商家取消订单时间必须是正整数');
            return;
        }
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveOrderCancelTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        orderCancelTime: $('#cancelOrderTime').val(), //商家取消订单时间
                        orderCancelTimeUseStatus: $('#cancelOrderStatus').val() //是否启用
                    },
                    success: function (e) {
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定提交?</div>'
        });

    }


    // 商家取消订单时间设置取消
    function cancelOrderCancelBtn() {

        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/saveOrderCancelTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        orderCancelTime: $('#cancelOrderTime').val(), //商家取消订单时间
                        orderCancelTimeUseStatus: 0 //是否启用
                    },
                    success: function (e) {
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定关闭?</div>'
        });

    }
    //////////////////////////////////////////////////////////////////////////////////
    // 付款时间设置确定
    function payConfirmBtn() {
        if ($('#payTime').val() == '') {
            layer.msg('请输入付款时间');
            return;
        }
        if (!zzsReg.test($('#payTime').val())) {
            layer.msg('付款时间必须是正整数');
            return;
        }
        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/savePayTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        payTime: $('#payTime').val(), //付款时间
                        payTimeUseStatus: $('#payStatus').val() //是否启用
                    },
                    success: function (e) {
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定提交?</div>'
        });

    }

    // 付款时间设置取消
    function payCancelBtn() {

        layer.open({
            type: 1,
            title: '提示',
            area: ['300px', '200px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                $.ajax({
                    url: port + '/v1/commonTime/savePayTime',
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    data: {
                        cId: localStorage.getItem('unitId'),
                        payTime: $('#payTime').val(), //付款时间
                        payTimeUseStatus: 0 //是否启用
                    },
                    success: function (e) {
                        if (e.status == 200) {
                            layer.msg('操作成功');
                            layer.close(index);
                            
                        }
                    }
                });
            },
            btnAlign: 'c',
            content: '<div style="text-align: center;margin-top: 45px;">确定关闭?</div>'
        });

    }
</script>

</html>